ds=brown_ext_abtree_lf;rm data_jax.csv;cols="%12s %12s %12s %12s\n"; printf "$cols" alg nthreads tput max_res; for n in 24 48 72 96 192 240; do for alg in token4 debra_df debra nbrplus nbr ibr_rcu qsbr 2geibr ibr_hp he wfe none; do avgtput=0 ; for ((trial=0;trial<5;++trial)); do sfname=step_${alg}_${n}_${trial}.txt; [[ $n -eq 240 ]] && LD_PRELOAD=../../lib/libjemalloc.so time -f "cmd:%C \nmemory:%M" -o timetemp.txt ./ubench_${ds}.alloc_new.reclaim_${alg}.pool_none.out -nwork $n -nprefill $n -i 50 -d 50 -rq 0 -rqsize 1 -k 20000000 -nrq 0 -t 5000 > ${sfname} || LD_PRELOAD=../../lib/libjemalloc.so time -f "cmd:%C \nmemory:%M" -o timetemp.txt numactl --interleave=all ./ubench_${ds}.alloc_new.reclaim_${alg}.pool_none.out -nwork $n -nprefill $n -i 50 -d 50 -rq 0 -rqsize 1 -k 20000000 -nrq 0 -t 5000 -pin 0-23,24-47,48-71,72-95,96-119,120-143,144-167,168-191 > ${sfname} ; tput=`cat ${sfname} | grep "total throughput" | cut -d ":" -f2 | tr -d " "  `; max_resmem=`cat timetemp.txt | grep memory | tail -1 | cut -d":" -f2` ; printf "%12s %12d %12d %12d\n" "$alg" "$n" "$tput" "$max_resmem" | tee templine.txt; cat templine.txt | paste -sd " " >> data_jax.csv; done; done ; echo "-------------------";done;






# for orig vs df

ds=brown_ext_abtree_lf;rm data_jax.csv;cols="%12s %12s %12s %12s\n"; printf "$cols" alg nthreads tput max_res; for n in 24 48 72 96 192 240; do for alg in debra debra_df nbrplus nbrplus_df nbr nbr_df ibr_rcu ibr_rcu_df qsbr qsbr_df 2geibr 2geibr_df ibr_hp ibr_hp_df he he_df wfe wfe_df none; do avgtput=0 ; for ((trial=0;trial<5;++trial)); do sfname=step_${alg}_${n}_${trial}.txt; [[ $n -eq 240 ]] && LD_PRELOAD=../../lib/libjemalloc.so time -f "cmd:%C \nmemory:%M" -o timetemp.txt ./ubench_${ds}.alloc_new.reclaim_${alg}.pool_none.out -nwork $n -nprefill $n -i 50 -d 50 -rq 0 -rqsize 1 -k 20000000 -nrq 0 -t 5000 > ${sfname} || LD_PRELOAD=../../lib/libjemalloc.so time -f "cmd:%C \nmemory:%M" -o timetemp.txt numactl --interleave=all ./ubench_${ds}.alloc_new.reclaim_${alg}.pool_none.out -nwork $n -nprefill $n -i 50 -d 50 -rq 0 -rqsize 1 -k 20000000 -nrq 0 -t 5000 -pin 0-23,24-47,48-71,72-95,96-119,120-143,144-167,168-191 > ${sfname} ; tput=`cat ${sfname} | grep "total throughput" | cut -d ":" -f2 | tr -d " "  `; max_resmem=`cat timetemp.txt | grep memory | tail -1 | cut -d":" -f2` ; printf "%12s %12d %12d %12d\n" "$alg" "$n" "$tput" "$max_resmem" | tee templine.txt; cat templine.txt | paste -sd " " >> data_jax.csv; done; done ; echo "-------------------";done;